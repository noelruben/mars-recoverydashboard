<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mars Recovery Station - Dashboard</title>
    <style>
        :root {
            --primary: #1a1a2e;
            --secondary: #16213e;
            --accent: #ff6b6b;
            --highlight: #4ecdc4;
            --space-bg: linear-gradient(rgba(10, 10, 30, 0.8), rgba(10, 10, 30, 0.8)),
                        url('https://images.unsplash.com/photo-1615430535007-94da764325d0?ixlib=rb-1.2.1&auto=format&fit=crop&w=1920&q=80');
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: var(--space-bg);
            background-size: cover;
            background-position: center;
            color: white;
            min-height: 100vh;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 40px;
            background: rgba(0, 0, 0, 0.5);
        }

        .header h1 {
            font-size: 1.8rem;
            color: white;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .dashboard-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            max-width: 1400px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .control-panel, .results-panel {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .panel-title {
            color: var(--accent);
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.4rem;
            border-bottom: 1px solid var(--highlight);
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
        }

        .btn {
            background: linear-gradient(135deg, var(--accent), #e94560);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            width: 100%;
            margin-top: 10px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }

        #threejs-container {
            width: 100%;
            height: 300px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .results-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .next-page-btn {
            background: var(--highlight);
            margin-top: 20px;
            display: inline-block;
            width: auto;
            padding: 10px 20px;
        }

        @media (max-width: 768px) {
            .dashboard-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
    <div class="header">
        <h1>Mars Recovery Station</h1>
        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>

    <div class="dashboard-container">
        <!-- Control Panel -->
        <div class="control-panel">
            <h2 class="panel-title"><i class="fas fa-cogs"></i> Control Panel</h2>

            <h3>Material Intake</h3>
            <div class="form-group">
                <label for="eva-suit">EVA Suit Fabric (kg)</label>
                <input type="number" id="eva-suit" placeholder="e.g., 12" value="12">
            </div>

            <div class="form-group">
                <label for="air-filters">Used Air Filters (kg)</label>
                <input type="number" id="air-filters" placeholder="e.g., 30" value="30">
            </div>

            <div class="form-group">
                <label for="carbon-scraps">Carbon Scraps (kg)</label>
                <input type="number" id="carbon-scraps" placeholder="e.g., 5" value="5">
            </div>

            <button class="btn" onclick="optimizeRecycling()">
                <i class="fas fa-recycle"></i> Optimize Recycling
            </button>

            <h3 style="margin-top: 30px;">3D Recovery Station Overview</h3>
            <div id="threejs-container"></div>

            <button class="btn next-page-btn" onclick="window.location.href='results.html'">
                View Detailed Results <i class="fas fa-arrow-right"></i>
            </button>
        </div>

        <!-- Results Preview -->
        <div class="results-panel">
            <h2 class="panel-title"><i class="fas fa-chart-line"></i> Quick Results Preview</h2>
            <div id="previewResults">
                <p style="text-align: center; color: rgba(255, 255, 255, 0.7);">
                    Enter material quantities and click "Optimize Recycling" to see a preview.
                </p>
            </div>
        </div>
    </div>

    <script>
        // Check if user is logged in
        if (localStorage.getItem('isLoggedIn') !== 'true') {
            window.location.href = 'index.html';
        }

        // Logout function
        function logout() {
            localStorage.removeItem('isLoggedIn');
            window.location.href = 'index.html';
        }

        // Initialize Three.js Mars Visualization
        document.addEventListener('DOMContentLoaded', function() {
            initThreeJS();
        });

        function initThreeJS() {
            const container = document.getElementById('threejs-container');

            // Scene setup
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000000);

            // Camera setup
            const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.z = 10;

            // Renderer setup
            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);

            // Controls for orbiting the 3D model
            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;

            // Lighting - Sunlight simulation
            const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(5, 10, 7);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 1024;
            directionalLight.shadow.mapSize.height = 1024;
            scene.add(directionalLight);

            // Create Mars surface with improved texture
            const marsTexture = new THREE.TextureLoader().load('https://upload.wikimedia.org/wikipedia/commons/thumb/0/02/OSIRIS_Mars_true_color.jpg/1200px-OSIRIS_Mars_true_color.jpg');
            const marsBumpMap = new THREE.TextureLoader().load('https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Mars_topography.jpg/1200px-Mars_topography.jpg');

            const marsGeometry = new THREE.SphereGeometry(5, 64, 64);
            const marsMaterial = new THREE.MeshStandardMaterial({
                map: marsTexture,
                bumpMap: marsBumpMap,
                bumpScale: 0.05,
                metalness: 0.1,
                roughness: 0.7
            });

            const mars = new THREE.Mesh(marsGeometry, marsMaterial);
            mars.receiveShadow = true;
            scene.add(mars);

            // Add atmosphere effect
            const atmosphereGeometry = new THREE.SphereGeometry(5.2, 64, 64);
            const atmosphereMaterial = new THREE.MeshStandardMaterial({
                color: 0x3366cc,
                transparent: true,
                opacity: 0.2,
                side: THREE.BackSide
            });
            const atmosphere = new THREE.Mesh(atmosphereGeometry, atmosphereMaterial);
            scene.add(atmosphere);

            // Create a more detailed recovery station
            createRecoveryStation(scene);

            // Animation loop
            function animate() {
                requestAnimationFrame(animate);
                controls.update();
                renderer.render(scene, camera);
                mars.rotation.y += 0.001;
            }

            // Handle window resize
            window.addEventListener('resize', function() {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            });

            animate();
        }

        function createRecoveryStation(scene) {
            // Base platform
            const baseGeometry = new THREE.CylinderGeometry(2, 2, 0.3, 32);
            const baseMaterial = new THREE.MeshStandardMaterial({
                color: 0x333333,
                metalness: 0.3,
                roughness: 0.7
            });
            const base = new THREE.Mesh(baseGeometry, baseMaterial);
            base.position.y = 0.15;
            base.position.z = -6;
            base.receiveShadow = true;
            base.castShadow = true;
            scene.add(base);

            // Main habitat dome
            const domeGeometry = new THREE.SphereGeometry(1.2, 32, 32, 0, Math.PI * 2, 0, Math.PI / 2);
            const domeMaterial = new THREE.MeshStandardMaterial({
                color: 0xaaaaaa,
                metalness: 0.2,
                roughness: 0.5,
                transparent: true,
                opacity: 0.8
            });
            const dome = new THREE.Mesh(domeGeometry, domeMaterial);
            dome.position.y = 1.2;
            dome.position.z = -6;
            dome.receiveShadow = true;
            dome.castShadow = true;
            scene.add(dome);

            // Solar panels
            const panelGeometry = new THREE.BoxGeometry(0.8, 0.05, 0.3);
            const panelMaterial = new THREE.MeshStandardMaterial({
                color: 0x222233,
                metalness: 0.7,
                roughness: 0.3
            });

            for (let i = 0; i < 4; i++) {
                const panel1 = new THREE.Mesh(panelGeometry, panelMaterial);
                panel1.position.set(-6 + i * 3, 1.5, -4);
                panel1.rotation.y = Math.PI / 4;
                panel1.castShadow = true;
                scene.add(panel1);

                const panel2 = new THREE.Mesh(panelGeometry, panelMaterial);
                panel2.position.set(-6 + i * 3, 1.5, -8);
                panel2.rotation.y = -Math.PI / 4;
                panel2.castShadow = true;
                scene.add(panel2);
            }

            // Processing units
            const unitGeometry = new THREE.CylinderGeometry(0.4, 0.4, 0.8, 32);

            // Thermal processor (red)
            const thermalMaterial = new THREE.MeshStandardMaterial({
                color: 0xff5555,
                metalness: 0.6,
                roughness: 0.4
            });
            const thermalUnit = new THREE.Mesh(unitGeometry, thermalMaterial);
            thermalUnit.position.set(-6, 0.8, -5);
            thermalUnit.castShadow = true;
            scene.add(thermalUnit);

            // Chemical processor (green)
            const chemicalMaterial = new THREE.MeshStandardMaterial({
                color: 0x55ff55,
                metalness: 0.6,
                roughness: 0.4
            });
            const chemicalUnit = new THREE.Mesh(unitGeometry, chemicalMaterial);
            chemicalUnit.position.set(-6, 0.8, -7);
            chemicalUnit.castShadow = true;
            scene.add(chemicalUnit);

            // Mechanical processor (blue)
            const mechanicalMaterial = new THREE.MeshStandardMaterial({
                color: 0x5555ff,
                metalness: 0.6,
                roughness: 0.4
            });
            const mechanicalUnit = new THREE.Mesh(unitGeometry, mechanicalMaterial);
            mechanicalUnit.position.set(-4, 0.8, -6);
            mechanicalUnit.castShadow = true;
            scene.add(mechanicalUnit);

            // Storage tanks
            const tankGeometry = new THREE.SphereGeometry(0.5, 32, 32);

            // Oxygen tank
            const oxygenMaterial = new THREE.MeshStandardMaterial({
                color: 0xaaaaff,
                metalness: 0.3,
                roughness: 0.7,
                transparent: true,
                opacity: 0.7
            });
            const oxygenTank = new THREE.Mesh(tankGeometry, oxygenMaterial);
            oxygenTank.position.set(-3, 1, -6);
            oxygenTank.castShadow = true;
            scene.add(oxygenTank);

            // Material storage tank
            const materialMaterial = new THREE.MeshStandardMaterial({
                color: 0xffaaaa,
                metalness: 0.3,
                roughness: 0.7,
                transparent: true,
                opacity: 0.7
            });
            const materialTank = new THREE.Mesh(tankGeometry, materialMaterial);
            materialTank.position.set(-3, 1, -7);
            materialTank.castShadow = true;
            scene.add(materialTank);

            // Add labels (simplified for this example)
            // In a real app, you might use CSS2DRenderer for better text rendering
        }

        // Optimize Recycling Function
        function optimizeRecycling() {
            const evaSuit = parseFloat(document.getElementById('eva-suit').value) || 0;
            const airFilters = parseFloat(document.getElementById('air-filters').value) || 0;
            const carbonScraps = parseFloat(document.getElementById('carbon-scraps').value) || 0;

            // Calculate results (simplified for demo)
            const totalInput = evaSuit + airFilters + carbonScraps;
            const oxygenRecovered = Math.round((evaSuit * 0.4 + carbonScraps * 0.6) * 10) / 10;
            const materialsRecovered = Math.round((evaSuit * 0.6 + airFilters * 0.3 + carbonScraps * 0.2) * 10) / 10;
            const dailyNeedPercentage = Math.min(Math.round((oxygenRecovered / 30) * 100), 100);

            // Update preview results
            const previewResults = document.getElementById('previewResults');
            previewResults.innerHTML = `
                <div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 10px;">
                    <h3>Quick Results</h3>
                    <p><strong>Total Input:</strong> ${totalInput} kg</p>
                    <p><strong>Oxygen Recovered:</strong> ${oxygenRecovered} kg (${dailyNeedPercentage}% of daily need)</p>
                    <p><strong>Materials Recovered:</strong> ${materialsRecovered} kg</p>
                    <p style="font-size: 0.9rem; color: rgba(255, 255, 255, 0.7);">
                        Click "View Detailed Results" for full analysis and visualizations.
                    </p>
                </div>
            `;

            // Store results for the results page
            localStorage.setItem('recyclingResults', JSON.stringify({
                evaSuit, airFilters, carbonScraps,
                oxygenRecovered, materialsRecovered, dailyNeedPercentage, totalInput
            }));
        }
    </script>
</body>
</html>
